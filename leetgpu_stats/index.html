<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 LeetGPU Unified Dashboard</title>
    
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1e3a8a 50%, #1e40af 100%);
            min-height: 100vh;
            color: #f8fafc;
            overflow-x: hidden;
        }

        .header {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            padding: 3rem 2rem;
            text-align: center;
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.3);
            border-bottom: 2px solid #3b82f6;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            pointer-events: none;
        }

        .header h1 {
            color: #3b82f6;
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
            letter-spacing: -0.025em;
            position: relative;
            z-index: 1;
        }

        .header p {
            color: #94a3b8;
            font-size: 1.2rem;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        .tabs {
            display: flex;
            justify-content: center;
            background: rgba(15, 23, 42, 0.9);
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
            padding: 0 2rem;
            backdrop-filter: blur(20px);
        }

        .tab {
            padding: 1rem 2rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            color: #cbd5e1;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .tab:hover {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .tab-content {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
        }

        .tab-content.active {
            display: block;
        }

        .chart-controls {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem auto;
            display: flex;
            align-items: center;
            gap: 1rem;
            max-width: 1200px;
            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.2);
        }

        .chart-controls label {
            font-weight: 700;
            color: #3b82f6;
            font-size: 1.1rem;
        }

        .chart-controls select {
            padding: 0.75rem 1rem;
            border: 1px solid rgba(59, 130, 246, 0.5);
            border-radius: 8px;
            background: rgba(15, 23, 42, 0.9);
            color: #f8fafc;
            font-size: 1rem;
            min-width: 250px;
            font-weight: 600;
        }

        .chart-controls select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .stat-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.2);
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 60px rgba(59, 130, 246, 0.4);
            border-color: #3b82f6;
        }

        .stat-number {
            font-size: 3.5rem;
            font-weight: 800;
            color: #3b82f6;
            margin-bottom: 0.5rem;
            line-height: 1;
        }

        .stat-label {
            color: #cbd5e1;
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .chart-container {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            margin: 2rem 0;
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .chart-title {
            color: #3b82f6;
            font-size: 1.6rem;
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
            margin: 1rem 0;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }

        .heatmap-grid {
            display: grid;
            grid-template-columns: 150px repeat(5, 1fr);
            grid-template-rows: 50px repeat(5, 1fr);
            gap: 3px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            padding: 15px;
            max-width: 850px;
            margin: 0 auto;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .heatmap-cell {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #f8fafc;
            text-align: center;
            padding: 8px;
            font-size: 0.9rem;
            border: 1px solid rgba(59, 130, 246, 0.2);
            transition: all 0.2s ease;
        }

        .heatmap-header {
            background: rgba(30, 58, 138, 0.9);
            color: #f8fafc;
            font-weight: 700;
            border: 1px solid #3b82f6;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.85rem;
        }

        .heatmap-data {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .heatmap-data:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
            border-color: #3b82f6;
        }

        .performance-level-1 { background: #28a745 !important; color: #ffffff !important; } /* Fastest - Green */
        .performance-level-2 { background: #20c997 !important; color: #ffffff !important; } /* Fast - Teal */
        .performance-level-3 { background: #ffc107 !important; color: #000000 !important; } /* Medium - Yellow */
        .performance-level-4 { background: #fd7e14 !important; color: #000000 !important; } /* Slow - Orange */
        .performance-level-5 { background: #dc3545 !important; color: #ffffff !important; } /* Slowest - Red */
        .no-data { 
            background: rgba(71, 85, 105, 0.6) !important; 
            color: #94a3b8 !important; 
            border: 1px solid rgba(71, 85, 105, 0.8) !important; 
        }

        .legend {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1.5rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #cbd5e1;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 6px;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .performance-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .performance-table th,
        .performance-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
        }

        .performance-table th {
            background: rgba(59, 130, 246, 0.2);
            color: #e2e8f0;
            font-weight: 600;
        }

        .performance-table td {
            background: rgba(30, 41, 59, 0.3);
        }

        .performance-table tbody tr:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .framework-cuda { color: #4CAF50; }
        .framework-triton { color: #2196F3; }
        .framework-pytorch { color: #FF9800; }
        .framework-mojo { color: #9C27B0; }
        .framework-tinygrad { color: #F44336; }

        .fastest-time {
            color: #10b981;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #94a3b8;
        }

        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #fca5a5;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .tabs { flex-direction: column; }
            .stats-overview { grid-template-columns: 1fr; }
            .charts-grid { grid-template-columns: 1fr; }
            .heatmap-grid { grid-template-columns: 120px repeat(5, 1fr); font-size: 0.8rem; }
            .tab-content { padding: 1rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🚀 LeetGPU Unified Dashboard</h1>
        <p>Single Challenge Analysis & Comprehensive Multi-Challenge Performance</p>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('single')">📊 Single Challenge</div>
        <div class="tab" onclick="switchTab('comprehensive')">📈 Comprehensive Analysis</div>
    </div>

    <!-- Single Challenge Tab -->
    <div id="single" class="tab-content active">
        <div class="chart-controls">
            <label for="challengeSelect">Select Challenge:</label>
            <select id="challengeSelect" onchange="changeSingleChallenge()">
                <option value="">Loading challenges...</option>
            </select>
        </div>
        
        <div class="stats-overview">
            <div class="stat-card">
                <div class="stat-number" id="totalCombinations">25</div>
                <div class="stat-label">Total Combinations</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="validResults">0</div>
                <div class="stat-label">Valid Results</div>
            </div>
            <div class="stat-card">
                <div class="stat-number fastest-time" id="fastestTime">0</div>
                <div class="stat-label">Fastest Runtime (ms)</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="successRate">0%</div>
                <div class="stat-label">Success Rate</div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title" id="heatmapTitle">🎯 Performance Heatmap</div>
            <div class="heatmap-grid" id="singleHeatmapGrid"></div>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color performance-level-1"></div>
                    <span>Fastest (0-0.1ms)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color performance-level-2"></div>
                    <span>Fast (0.1-0.5ms)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color performance-level-3"></div>
                    <span>Medium (0.5-1ms)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color performance-level-4"></div>
                    <span>Slow (1-2ms)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color performance-level-5"></div>
                    <span>Slowest (2ms+)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color no-data"></div>
                    <span>No Data</span>
                </div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-container">
                <div class="chart-title">📊 Performance by Framework</div>
                <div class="chart-wrapper">
                    <canvas id="singleFrameworkChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">🎮 Performance by GPU</div>
                <div class="chart-wrapper">
                    <canvas id="singleGpuChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Comprehensive Tab -->
    <div id="comprehensive" class="tab-content">
        <div class="stats-overview">
            <div class="stat-card">
                <div class="stat-number">36</div>
                <div class="stat-label">Total Challenges</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">900</div>
                <div class="stat-label">Total Combinations</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="successfulResults">-</div>
                <div class="stat-label">Successful Results</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="overallSuccessRate">-</div>
                <div class="stat-label">Success Rate</div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-container">
                <div class="chart-title">🏆 First Place Wins (Challenge × GPU)</div>
                <div class="chart-wrapper">
                    <canvas id="winsChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">✅ Success Rate by Framework</div>
                <div class="chart-wrapper">
                    <canvas id="successChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">⚡ Average Performance per GPU</div>
                <div class="chart-wrapper">
                    <canvas id="avgPerformanceChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">🎯 Overall Framework Ranking</div>
                <div class="chart-wrapper">
                    <canvas id="overallRankingChart"></canvas>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">📋 Detailed Performance Table</div>
            <div style="overflow-x: auto;">
                <table class="performance-table" id="performanceTable">
                    <thead>
                        <tr>
                            <th>Framework</th>
                            <th>GPU</th>
                            <th>Wins</th>
                            <th>Valid Results</th>
                            <th>Success Rate</th>
                            <th>Avg Time (ms)</th>
                        </tr>
                    </thead>
                    <tbody id="performanceTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let comprehensiveData = [];
        let processedData = {};
        let availableChallenges = [];
        let currentChallenge = 'vector-addition';
        let currentResults = [];
        
        // Constants
        const FRAMEWORKS = ["CUDA", "TRITON", "PYTORCH", "MOJO", "TINYGRAD"];
        const GPUS = ["NVIDIA TESLA T4", "NVIDIA A100-80GB", "NVIDIA H100", "NVIDIA H200", "NVIDIA B200"];
        
        const frameworkColors = {
            'CUDA': '#4CAF50',
            'TRITON': '#2196F3', 
            'PYTORCH': '#FF9800',
            'MOJO': '#9C27B0',
            'TINYGRAD': '#F44336'
        };

        const gpuColors = {
            'NVIDIA TESLA T4': '#FF6384',
            'NVIDIA A100-80GB': '#36A2EB', 
            'NVIDIA H100': '#FFCE56',
            'NVIDIA H200': '#4BC0C0',
            'NVIDIA B200': '#9966FF'
        };

        // Fallback data for Vector Addition
        const fallbackData = [
            {"framework": "CUDA", "gpu": "NVIDIA TESLA T4", "fastest_ms": 0.002, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "CUDA", "gpu": "NVIDIA A100-80GB", "fastest_ms": 0.1757, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "CUDA", "gpu": "NVIDIA H100", "fastest_ms": 0.0998, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "CUDA", "gpu": "NVIDIA H200", "fastest_ms": 0.0774, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "CUDA", "gpu": "NVIDIA B200", "fastest_ms": 0.048, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "TRITON", "gpu": "NVIDIA TESLA T4", "fastest_ms": 1.182, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "TRITON", "gpu": "NVIDIA A100-80GB", "fastest_ms": 0.2009, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "TRITON", "gpu": "NVIDIA H100", "fastest_ms": 0.1214, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "TRITON", "gpu": "NVIDIA H200", "fastest_ms": 0.0963, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "TRITON", "gpu": "NVIDIA B200", "fastest_ms": 0.0705, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "PYTORCH", "gpu": "NVIDIA TESLA T4", "fastest_ms": 1.2038, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "PYTORCH", "gpu": "NVIDIA A100-80GB", "fastest_ms": 0.1768, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "PYTORCH", "gpu": "NVIDIA H100", "fastest_ms": 0.1034, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "PYTORCH", "gpu": "NVIDIA H200", "fastest_ms": 0.078, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "PYTORCH", "gpu": "NVIDIA B200", "fastest_ms": 0.0488, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "MOJO", "gpu": "NVIDIA TESLA T4", "fastest_ms": 1.2245, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "MOJO", "gpu": "NVIDIA A100-80GB", "fastest_ms": 0.226, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "MOJO", "gpu": "NVIDIA H100", "fastest_ms": 0.162, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "MOJO", "gpu": "NVIDIA H200", "fastest_ms": null, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "MOJO", "gpu": "NVIDIA B200", "fastest_ms": 0.1059, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "TINYGRAD", "gpu": "NVIDIA TESLA T4", "fastest_ms": 2.213, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "TINYGRAD", "gpu": "NVIDIA A100-80GB", "fastest_ms": 1.2522, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "TINYGRAD", "gpu": "NVIDIA H100", "fastest_ms": 0.8807, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "TINYGRAD", "gpu": "NVIDIA H200", "fastest_ms": null, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."},
            {"framework": "TINYGRAD", "gpu": "NVIDIA B200", "fastest_ms": null, "challenge_name": "vector-addition", "challenge_title": "Easy\nVector Addition\n..."}
        ];

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'comprehensive' && comprehensiveData.length > 0) {
                initComprehensiveCharts();
            }
        }

        // Performance level helper
        function getPerformanceLevel(time) {
            if (time === null) return 'no-data';
            if (time <= 0.1) return 'performance-level-1';
            if (time <= 0.5) return 'performance-level-2';
            if (time <= 1.0) return 'performance-level-3';
            if (time <= 2.0) return 'performance-level-4';
            return 'performance-level-5';
        }

        // Challenge management
        function changeSingleChallenge() {
            const selectedChallenge = document.getElementById('challengeSelect').value;
            if (selectedChallenge && selectedChallenge !== currentChallenge) {
                currentChallenge = selectedChallenge;
                loadChallengeData(selectedChallenge);
            }
        }

        function loadChallengeData(challengeName) {
            console.log('Loading challenge data for:', challengeName);
            
            let challengeData = [];
            let challengeTitle = challengeName;
            
            if (comprehensiveData.length > 0) {
                challengeData = comprehensiveData.filter(r => r.challenge_name === challengeName);
                const sample = challengeData[0];
                if (sample && sample.challenge_title) {
                    const titleParts = sample.challenge_title.split('\n');
                    challengeTitle = titleParts.length > 1 ? titleParts[1] : titleParts[0];
                }
            } else if (challengeName === 'vector-addition') {
                challengeData = fallbackData;
                challengeTitle = 'Vector Addition';
            }
            
            currentResults = challengeData;
            console.log('Loaded', challengeData.length, 'results for', challengeName);
            
            updateSingleChallengeStats(challengeTitle);
            generateHeatmap(challengeTitle);
            createSingleFrameworkChart();
            createSingleGpuChart();
        }

        function updateSingleChallengeStats(challengeTitle) {
            const validResults = currentResults.filter(r => r.fastest_ms !== null);
            const totalCombinations = 25;
            const successRate = ((validResults.length / totalCombinations) * 100).toFixed(0);
            const fastestTime = validResults.length > 0 ? Math.min(...validResults.map(r => r.fastest_ms)) : 0;
            
            document.getElementById('totalCombinations').textContent = totalCombinations;
            document.getElementById('validResults').textContent = validResults.length;
            document.getElementById('fastestTime').textContent = fastestTime.toFixed(3);
            document.getElementById('successRate').textContent = successRate + '%';
            
            const heatmapTitle = document.getElementById('heatmapTitle');
            if (heatmapTitle) {
                heatmapTitle.textContent = `🎯 ${challengeTitle} Performance Heatmap`;
            }
        }

        function generateHeatmap(challengeTitle) {
            const grid = document.getElementById('singleHeatmapGrid');
            if (!grid) return;
            
            grid.innerHTML = '<div class="heatmap-cell heatmap-header">Framework / GPU</div>';
            
            GPUS.forEach(gpu => {
                const cell = document.createElement('div');
                cell.className = 'heatmap-cell heatmap-header';
                cell.textContent = gpu.replace('NVIDIA ', '').replace('-80GB', '');
                grid.appendChild(cell);
            });

            FRAMEWORKS.forEach(framework => {
                const headerCell = document.createElement('div');
                headerCell.className = 'heatmap-cell heatmap-header';
                headerCell.textContent = framework;
                grid.appendChild(headerCell);

                GPUS.forEach(gpu => {
                    const result = currentResults.find(r => r.framework === framework && r.gpu === gpu);
                    const cell = document.createElement('div');
                    const time = result ? result.fastest_ms : null;
                    cell.className = `heatmap-cell heatmap-data ${getPerformanceLevel(time)}`;
                    cell.textContent = time ? `${time}ms` : 'No Data';
                    cell.title = `${framework} on ${gpu}: ${time ? time + 'ms' : 'No Data'}`;
                    grid.appendChild(cell);
                });
            });
        }

        function createSingleFrameworkChart() {
            console.log('Creating single framework chart...');
            const canvas = document.getElementById('singleFrameworkChart');
            if (!canvas) {
                console.log('Framework chart canvas not found');
                return;
            }
            
            console.log('Canvas found, checking Chart.js...');
            if (typeof Chart === 'undefined') {
                console.error('Chart.js not loaded!');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            if (window.singleFrameworkChart && typeof window.singleFrameworkChart.destroy === 'function') {
                console.log('Destroying existing framework chart');
                window.singleFrameworkChart.destroy();
            }
            
            const frameworkData = FRAMEWORKS.map(framework => {
                const times = currentResults
                    .filter(r => r.framework === framework && r.fastest_ms !== null)
                    .map(r => r.fastest_ms);
                return times.length > 0 ? Math.min(...times) : null;
            });

            console.log('Creating chart with data:', frameworkData);
            try {
                const newChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: FRAMEWORKS,
                        datasets: [{
                            label: 'Fastest Runtime (ms)',
                            data: frameworkData,
                            backgroundColor: ['#3b82f6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444'],
                            borderColor: ['#1e40af', '#0891b2', '#059669', '#d97706', '#dc2626'],
                            borderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: 'Runtime (ms)', color: '#f8fafc' },
                                ticks: { color: '#f8fafc' },
                                grid: { color: 'rgba(248, 250, 252, 0.1)' }
                            },
                            x: { 
                                ticks: { color: '#f8fafc' },
                                grid: { color: 'rgba(248, 250, 252, 0.1)' }
                            }
                        }
                    }
                });
                window.singleFrameworkChart = newChart;
                console.log('Framework chart created successfully');
            } catch (error) {
                console.error('Error creating framework chart:', error);
                window.singleFrameworkChart = null;
            }
        }

        function createSingleGpuChart() {
            console.log('Creating single GPU chart...');
            const canvas = document.getElementById('singleGpuChart');
            if (!canvas) {
                console.log('GPU chart canvas not found');
                return;
            }
            
            if (typeof Chart === 'undefined') {
                console.error('Chart.js not loaded for GPU chart!');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            if (window.singleGpuChart && typeof window.singleGpuChart.destroy === 'function') {
                console.log('Destroying existing GPU chart');
                window.singleGpuChart.destroy();
            }
            
            const gpuData = GPUS.map(gpu => {
                const times = currentResults
                    .filter(r => r.gpu === gpu && r.fastest_ms !== null)
                    .map(r => r.fastest_ms);
                return times.length > 0 ? Math.min(...times) : null;
            });

            console.log('Creating GPU chart with data:', gpuData);
            try {
                const newChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: GPUS.map(gpu => gpu.replace('NVIDIA ', '')),
                        datasets: [{
                            label: 'Fastest Runtime (ms)',
                            data: gpuData,
                            backgroundColor: ['#3b82f6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444'],
                            borderColor: ['#1e40af', '#0891b2', '#059669', '#d97706', '#dc2626'],
                            borderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: 'Runtime (ms)', color: '#f8fafc' },
                                ticks: { color: '#f8fafc' },
                                grid: { color: 'rgba(248, 250, 252, 0.1)' }
                            },
                            x: { 
                                ticks: { color: '#f8fafc' },
                                grid: { color: 'rgba(248, 250, 252, 0.1)' }
                            }
                        }
                    }
                });
                window.singleGpuChart = newChart;
                console.log('GPU chart created successfully');
            } catch (error) {
                console.error('Error creating GPU chart:', error);
                window.singleGpuChart = null;
            }
        }

        // Data loading - Copy from working debug version
        async function loadComprehensiveData() {
            try {
                console.log('Fetching comprehensive data...');
                const response = await fetch('./all_challenges_results_20250707_045604.json');
                console.log(`Response status: ${response.status}`);
                
                if (!response.ok) {
                    console.log(`HTTP Error: ${response.status} ${response.statusText}`);
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                console.log('Parsing JSON...');
                const data = await response.json();
                console.log(`JSON parsed successfully. Total challenges: ${data.total_challenges}`);
                
                if (!data.results || !Array.isArray(data.results)) {
                    console.log('Invalid data structure - no results array');
                    throw new Error('Invalid data format');
                }
                
                comprehensiveData = data.results;
                console.log(`Loaded ${comprehensiveData.length} result records`);
                
                // Test data structure
                if (comprehensiveData.length > 0) {
                    const sample = comprehensiveData[0];
                    console.log(`Sample record: challenge="${sample.challenge_name}", framework="${sample.framework}", gpu="${sample.gpu}", time=${sample.fastest_ms}ms`);
                }
                
                // Extract unique challenges - COPY FROM DEBUG VERSION
                const uniqueChallenges = [...new Set(comprehensiveData.map(r => r.challenge_name))];
                console.log(`Found ${uniqueChallenges.length} unique challenges`);
                
                // Create challenge list - COPY FROM DEBUG VERSION
                availableChallenges = uniqueChallenges.map(challengeName => {
                    const sample = comprehensiveData.find(r => r.challenge_name === challengeName);
                    let title = challengeName;
                    if (sample && sample.challenge_title) {
                        const titleParts = sample.challenge_title.split('\n');
                        title = titleParts.length > 1 ? titleParts[1] : titleParts[0];
                    }
                    return {
                        name: challengeName,
                        title: title
                    };
                });
                
                console.log(`Created ${availableChallenges.length} challenge options`);
                
                // Populate selector - COPY FROM DEBUG VERSION
                populateChallengeSelector();
                
                // Process data for comprehensive view
                processComprehensiveData();
                updateComprehensiveStats();
                
                // Load default challenge
                loadChallengeData('vector-addition');
                
            } catch (error) {
                console.error('Error loading comprehensive data:', error);
                console.log(`Stack trace: ${error.stack}`);
                // Fall back to vector addition only
                setupFallbackMode();
            }
        }

        function setupFallbackMode() {
            console.log('Setting up fallback mode with vector addition only');
            availableChallenges = [{ name: 'vector-addition', title: 'Vector Addition' }];
            populateChallengeSelector();
            loadChallengeData('vector-addition');
        }

        function populateChallengeSelector() {
            const selector = document.getElementById('challengeSelect');
            if (!selector) {
                console.log('Challenge selector element not found');
                return;
            }
            
            selector.innerHTML = '';
            
            if (availableChallenges.length === 0) {
                console.log('No challenges available to populate selector');
                selector.innerHTML = '<option value="">No challenges available</option>';
                return;
            }
            
            availableChallenges.forEach(challenge => {
                const option = document.createElement('option');
                option.value = challenge.name;
                option.textContent = challenge.title;
                selector.appendChild(option);
            });
            
            // Set default selection
            if (selector.options.length > 0) {
                selector.value = 'vector-addition';
            }
            
            console.log(`Populated selector with ${availableChallenges.length} options`);
        }

        function processComprehensiveData() {
            console.log('Processing comprehensive data...');
            
            if (comprehensiveData.length === 0) {
                console.log('No comprehensive data to process');
                return;
            }
            
            processedData = {
                frameworks: FRAMEWORKS,
                gpus: GPUS,
                wins: {},
                successCounts: {},
                avgTimes: {}
            };

            // Initialize data structures
            processedData.frameworks.forEach(framework => {
                processedData.wins[framework] = {};
                processedData.successCounts[framework] = {};
                processedData.avgTimes[framework] = {};
                
                processedData.gpus.forEach(gpu => {
                    processedData.wins[framework][gpu] = 0;
                    processedData.successCounts[framework][gpu] = 0;
                    processedData.avgTimes[framework][gpu] = [];
                });
            });

            // Group by challenge and GPU to find winners
            const challengeGpuGroups = {};
            comprehensiveData.forEach(result => {
                const key = `${result.challenge_name}_${result.gpu}`;
                if (!challengeGpuGroups[key]) {
                    challengeGpuGroups[key] = [];
                }
                challengeGpuGroups[key].push(result);
            });

            // Process each challenge-GPU combination
            Object.values(challengeGpuGroups).forEach(group => {
                const validResults = group.filter(r => r.fastest_ms !== null);
                if (validResults.length > 0) {
                    const fastest = validResults.reduce((min, current) => 
                        current.fastest_ms < min.fastest_ms ? current : min
                    );
                    processedData.wins[fastest.framework][fastest.gpu]++;
                }

                group.forEach(result => {
                    if (result.fastest_ms !== null) {
                        processedData.successCounts[result.framework][result.gpu]++;
                        processedData.avgTimes[result.framework][result.gpu].push(result.fastest_ms);
                    }
                });
            });

            // Calculate averages
            processedData.frameworks.forEach(framework => {
                processedData.gpus.forEach(gpu => {
                    const times = processedData.avgTimes[framework][gpu];
                    if (times.length > 0) {
                        processedData.avgTimes[framework][gpu] = times.reduce((a, b) => a + b, 0) / times.length;
                    } else {
                        processedData.avgTimes[framework][gpu] = null;
                    }
                });
            });
            
            console.log('Comprehensive data processing complete', processedData);
        }

        function updateComprehensiveStats() {
            if (comprehensiveData.length === 0) return;
            
            const totalResults = comprehensiveData.length;
            const successfulResults = comprehensiveData.filter(r => r.fastest_ms !== null).length;
            const successRate = ((successfulResults / totalResults) * 100).toFixed(1);

            document.getElementById('successfulResults').textContent = successfulResults;
            document.getElementById('overallSuccessRate').textContent = successRate + '%';
        }

        function initComprehensiveCharts() {
            console.log('Initializing comprehensive charts...');
            
            if (comprehensiveData.length === 0) {
                console.log('No comprehensive data available for charts');
                return;
            }
            
            createWinsChart();
            createSuccessChart();
            createAvgPerformanceChart();
            createOverallRankingChart();
            createPerformanceTable();
        }

        // Comprehensive chart functions
        function createWinsChart() {
            console.log('Creating wins chart...');
            const canvas = document.getElementById('winsChart');
            if (!canvas) {
                console.log('Wins chart canvas not found');
                return;
            }
            
            if (typeof Chart === 'undefined') {
                console.error('Chart.js not loaded for wins chart!');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            if (window.winsChart && typeof window.winsChart.destroy === 'function') {
                window.winsChart.destroy();
            }
            
            const datasets = processedData.gpus.map(gpu => ({
                label: gpu.replace('NVIDIA ', ''),
                data: processedData.frameworks.map(framework => processedData.wins[framework][gpu]),
                backgroundColor: gpuColors[gpu] + '80',
                borderColor: gpuColors[gpu],
                borderWidth: 2
            }));

            try {
                const newChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: processedData.frameworks,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                display: true,
                                labels: { color: '#ffffff' } 
                            } 
                        },
                        scales: {
                            x: { ticks: { color: '#ffffff' } },
                            y: { 
                                ticks: { color: '#ffffff' },
                                title: { display: true, text: 'Number of Wins', color: '#ffffff' }
                            }
                        }
                    }
                });
                window.winsChart = newChart;
                console.log('Wins chart created successfully');
            } catch (error) {
                console.error('Error creating wins chart:', error);
            }
        }

        function createSuccessChart() {
            console.log('Creating success chart...');
            const canvas = document.getElementById('successChart');
            if (!canvas) {
                console.log('Success chart canvas not found');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            if (window.successChart && typeof window.successChart.destroy === 'function') {
                window.successChart.destroy();
            }
            
            const datasets = processedData.gpus.map(gpu => ({
                label: gpu.replace('NVIDIA ', ''),
                data: processedData.frameworks.map(framework => {
                    const successCount = processedData.successCounts[framework][gpu];
                    const uniqueChallenges = [...new Set(comprehensiveData.map(r => r.challenge_name))].length;
                    return ((successCount / uniqueChallenges) * 100).toFixed(1);
                }),
                backgroundColor: gpuColors[gpu] + '80',
                borderColor: gpuColors[gpu],
                borderWidth: 2
            }));

            try {
                const newChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: processedData.frameworks,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                display: true,
                                labels: { color: '#ffffff' } 
                            } 
                        },
                        scales: {
                            x: { ticks: { color: '#ffffff' } },
                            y: { 
                                ticks: { color: '#ffffff' },
                                title: { display: true, text: 'Success Rate (%)', color: '#ffffff' },
                                max: 100
                            }
                        }
                    }
                });
                window.successChart = newChart;
                console.log('Success chart created successfully');
            } catch (error) {
                console.error('Error creating success chart:', error);
            }
        }

        function createAvgPerformanceChart() {
            console.log('Creating avg performance chart...');
            const canvas = document.getElementById('avgPerformanceChart');
            if (!canvas) {
                console.log('Avg performance chart canvas not found');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            if (window.avgPerformanceChart && typeof window.avgPerformanceChart.destroy === 'function') {
                window.avgPerformanceChart.destroy();
            }
            
            const datasets = processedData.frameworks.map(framework => ({
                label: framework,
                data: processedData.gpus.map(gpu => {
                    const avgTime = processedData.avgTimes[framework][gpu];
                    return avgTime !== null ? avgTime.toFixed(3) : null;
                }),
                backgroundColor: frameworkColors[framework] + '80',
                borderColor: frameworkColors[framework],
                borderWidth: 2
            }));

            try {
                const newChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: processedData.gpus.map(gpu => gpu.replace('NVIDIA ', '')),
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                display: true,
                                labels: { color: '#ffffff' } 
                            } 
                        },
                        scales: {
                            x: { ticks: { color: '#ffffff' } },
                            y: { 
                                ticks: { color: '#ffffff' },
                                title: { display: true, text: 'Average Time (ms)', color: '#ffffff' },
                                type: 'logarithmic'
                            }
                        }
                    }
                });
                window.avgPerformanceChart = newChart;
                console.log('Avg performance chart created successfully');
            } catch (error) {
                console.error('Error creating avg performance chart:', error);
            }
        }

        function createOverallRankingChart() {
            console.log('Creating overall ranking chart...');
            const canvas = document.getElementById('overallRankingChart');
            if (!canvas) {
                console.log('Overall ranking chart canvas not found');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            if (window.overallRankingChart && typeof window.overallRankingChart.destroy === 'function') {
                window.overallRankingChart.destroy();
            }
            
            const frameworkScores = processedData.frameworks.map(framework => {
                let totalWins = 0;
                let totalSuccess = 0;
                
                processedData.gpus.forEach(gpu => {
                    totalWins += processedData.wins[framework][gpu];
                    totalSuccess += processedData.successCounts[framework][gpu];
                });
                
                return {
                    framework,
                    wins: totalWins,
                    successRate: (totalSuccess / (comprehensiveData.length / 5)) * 100
                };
            });
            
            frameworkScores.sort((a, b) => b.wins - a.wins);

            try {
                const newChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: frameworkScores.map(f => f.framework),
                        datasets: [{
                            data: frameworkScores.map(f => f.wins),
                            backgroundColor: frameworkScores.map(f => frameworkColors[f.framework]),
                            borderColor: '#1a2332',
                            borderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: '#ffffff', padding: 20 }
                            }
                        }
                    }
                });
                window.overallRankingChart = newChart;
                console.log('Overall ranking chart created successfully');
            } catch (error) {
                console.error('Error creating overall ranking chart:', error);
            }
        }

        function createPerformanceTable() {
            console.log('Creating performance table...');
            const tableBody = document.getElementById('performanceTableBody');
            if (!tableBody) {
                console.log('Performance table body not found');
                return;
            }
            
            tableBody.innerHTML = '';

            processedData.frameworks.forEach(framework => {
                processedData.gpus.forEach(gpu => {
                    const wins = processedData.wins[framework][gpu];
                    const successCount = processedData.successCounts[framework][gpu];
                    const uniqueChallenges = [...new Set(comprehensiveData.map(r => r.challenge_name))].length;
                    const successRate = ((successCount / uniqueChallenges) * 100).toFixed(1);
                    const avgTime = processedData.avgTimes[framework][gpu];
                    
                    const row = tableBody.insertRow();
                    row.innerHTML = `
                        <td class="framework-${framework.toLowerCase()}">${framework}</td>
                        <td>${gpu.replace('NVIDIA ', '')}</td>
                        <td>${wins}</td>
                        <td>${successCount}/${uniqueChallenges}</td>
                        <td>${successRate}%</td>
                        <td>${avgTime !== null ? avgTime.toFixed(3) + ' ms' : 'No data'}</td>
                    `;
                });
            });
            
            console.log('Performance table created successfully');
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing dashboard...');
            
            // Start with fallback data for immediate display
            setupFallbackMode();
            
            // Try to load comprehensive data asynchronously
            setTimeout(() => {
                loadComprehensiveData();
            }, 100);
        });
    </script>
</body>
</html> 